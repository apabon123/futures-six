# ============================================================================
# Phase 4 V1 Stack (No VRP) + Carry (VX + SR3 Calendar Spread) — Integration Eval
# ============================================================================
#
# Purpose: Trend + CSMOM + Curve RV + VX carry + SR3 calendar spread carry. VRP disabled.
# sr3_carry_curve disabled.
#
# Run: python3 run_strategy.py --config_path configs/phase4_v1_stack_no_vrp_plus_carry_vx_plus_sr3spread.yaml \
#      --run_id carry_int_v1stack_no_vrp_plus_vx_and_sr3spread_20200106_20251031_<timestamp> \
#      --start 2020-01-06 --end 2025-10-31 --strict_universe

engine_policy_v1:
  enabled: false
  mode: "off"
  engines:
    trend:
      enabled: true
    vrp:
      enabled: false
    csmom:
      enabled: false
    vrp_core_meta:
      enabled: false
    vrp_convergence_meta:
      enabled: false
    vrp_alt_meta:
      enabled: false
    vx_calendar_carry:
      enabled: false
    sr3_curve_rv_meta:
      enabled: false

risk_targeting:
  enabled: true
  target_vol: 0.20
  vol_lookback: 63
  leverage_cap: 7.0
  leverage_floor: 1.0
  vol_floor: 0.05
  update_frequency: "static"

allocator_v1:
  enabled: true
  mode: "off"
  profile: "H"
  precomputed_run_id: null
  precomputed_scalar_filename: "allocator_risk_v1_applied.csv"
  apply_missing_scalar_as: 1.0
  state_version: "v1.0"
  regime_version: "v1.0"
  risk_version: "v1.0"

exec:
  rebalance: "W-FRI"
  slippage_bps: 0.5
  commission_per_contract: 0.0
  position_notional_scale: 1.0

risk_vol:
  cov_lookback: 252
  nan_policy: "mask-asset"
  shrinkage: "lw"
  vol_lookback: 63

# STRATEGIES — Trend + CSMOM + Curve RV + VX carry + SR3 calendar spread carry (no VRP, sr3_carry_curve disabled)
strategies:
  tsmom_multihorizon:
    enabled: true
    weight: 0.52
    params:
      horizon_weights:
        long_252: 0.50
        med_84: 0.30
        short_21: 0.20
      feature_weights:
        long:
          ret_252: 0.5
          breakout_252: 0.3
          slope_slow: 0.2
        med:
          ret_84: 0.4
          breakout_126: 0.3
          slope_med: 0.2
          persistence: 0.1
        short:
          ret_21: 0.5
          breakout_21: 0.3
          slope_fast: 0.2
          reversal: 0.0
        breakout_mid_50_100:
          breakout_50: 0.7
          breakout_100: 0.3
      signal_cap: 3.0
      rebalance: "W-FRI"
      vol_normalization:
        enabled: true
        halflife_days: 63
        sigma_floor_annual: 0.05
        risk_scale: 0.2

  csmom_meta:
    enabled: true
    weight: 0.22
    params:
      lookbacks: [63, 126, 252]
      horizon_weights: [0.4, 0.35, 0.25]
      vol_lookback: 63
      rebalance: "D"
      neutralize_cross_section: true
      clip: 3.0

  vrp_core_meta:
    enabled: false
    weight: 0.0
  vrp_convergence_meta:
    enabled: false
    weight: 0.0
  vrp_alt_meta:
    enabled: false
    weight: 0.0

  sr3_curve_rv_meta:
    enabled: true
    weight: 0.08
    params:
      enabled_atomics: ["rank_fly", "pack_slope"]
      atomic_weights:
        rank_fly: 0.625
        pack_slope: 0.375
      zscore_window: 252
      clip: 3.0
      target_vol: 0.10
      vol_lookback: 63
      min_vol_floor: 0.01
      max_leverage: 10.0
      lag: 1

  sr3_carry_curve:
    enabled: false
    weight: 0.0

  vx_calendar_carry:
    enabled: true
    weight: 0.08
    params:
      variant: "vx2_vx1_short"
      zscore_window: 90
      clip: 2.0
      target_vol: 0.10
      vol_lookback: 60
      min_vol_floor: 0.01
      max_leverage: 10.0
      lag: 1

  sr3_calendar_spread_carry:
    enabled: true
    weight: 0.10
    params:
      mode: "phase1"
      zscore_window: 90
      clip: 2.0
      target_vol: 0.10
      vol_lookback: 60
      use_dv01: false
      lag: 1

  tsmom:
    enabled: false
    weight: 0.0
  tsmom_med:
    enabled: false
    weight: 0.0
  tsmom_short:
    enabled: false
    weight: 0.0
  tsmom_med_canonical:
    enabled: false
    weight: 0.0
  rates_curve:
    enabled: false
    weight: 0.0
  fx_commod_carry:
    enabled: false
    weight: 0.0
  residual_trend:
    enabled: false
    weight: 0.0
  persistence:
    enabled: false
    weight: 0.0
  long_only:
    enabled: false
    weight: 0.0
  long_momentum:
    enabled: false
    weight: 0.0

macro_regime:
  enabled: false
